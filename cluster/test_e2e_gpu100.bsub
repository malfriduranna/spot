#!/bin/bash
#BSUB -J spot-test
#BSUB -q gpuv100
#BSUB -gpu "num=1"
#BSUB -n 4
#BSUB -W 04:00
#BSUB -R "rusage[mem=16GB]"
#BSUB -o logs/test_e2e_%J.out
#BSUB -e logs/test_e2e_%J.err

set -euo pipefail
cd "${LS_SUBCWD}"
mkdir -p logs

# === Adjust these paths/modules to match the DTU cluster environment ===
module load python3/3.9.19 2>/dev/null || {
    echo "Unable to load python3/3.9.19 (edit cluster/test_e2e_gpu100.bsub)." >&2
    exit 1
}
module load cuda/12.1 || true

VENV_PATH="${HOME}/.virtualenvs/spot"
if [ ! -d "${VENV_PATH}" ]; then
    python3 -m venv "${VENV_PATH}"
    source "${VENV_PATH}/bin/activate"
    pip install --upgrade pip
    pip install -r requirements.txt
else
    source "${VENV_PATH}/bin/activate"
fi
# === End environment setup ===

python3 test_e2e.py \
  pretrained/soccernet_rgb \
  frames/custom \
  -s test \
  --save \
  -d soccernetv2
